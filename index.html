<!doctype html>
<html>
<head>
<meta charset='utf-8'/>
<meta name='viewport' content='width=device-width,initial-scale=1' />
<title>Splash - Flow Dashboard (Firebase)</title>
<style>
/* ... (Bagian Style CSS tetap sama) ... */
:root{--bg:#f4fafc;--card:#eaf9ff;--accent:#1e6fb8;--ok:#19a974;--danger:#e03b3b}
body{font-family:Inter,Arial,Helvetica,sans-serif;background:var(--bg);margin:0;padding:18px}
.wrap{max-width:1200px;margin:auto}
.header{display:flex;align-items:center;justify-content:center;padding:10px 0}
.grid{display:grid;grid-template-columns:1fr 440px;gap:18px}
.left{display:grid;gap:18px}
.card{background:linear-gradient(180deg,#ffffff,#f9feff);padding:18px;border-radius:18px;box-shadow:0 6px 20px rgba(0,0,0,0.06)}
.gauge-row{display:flex;gap:18px;align-items:center;flex-wrap:wrap}
.gauge{width:320px;height:200px;display:flex;flex-direction:column;align-items:center;justify-content:center;background:var(--card);border-radius:12px;padding:10px}
.gauge svg{width:220px;height:120px;overflow:visible}
.percent{font-size:20px;color:var(--accent);font-weight:700;margin-top:6px}
.status{background:#e8fbff;padding:14px;border-radius:12px;display:flex;flex-direction:column;gap:10px}
.badge{display:inline-block;padding:8px 12px;border-radius:10px;font-weight:800}
.badge.danger{background:var(--danger);color:#fff}
.badge.ok{background:var(--ok);color:#fff}
.status-row{display:flex;justify-content:space-between;align-items:center}
.indicator{padding:8px 12px;border-radius:8px;font-weight:700}
.indicator.on{background:var(--ok);color:#fff}
.indicator.off{background:#ddd;color:#333}
.ctrl{display:flex;align-items:center;gap:12px;margin-top:12px}
.btn{padding:10px 16px;border-radius:999px;border:none;cursor:pointer;font-weight:700}
.btn.on{background:var(--ok);color:white}.btn.off{background:#ddd;color:#444}
.chart-card{background:linear-gradient(180deg,#fff,#f7feff);padding:14px;border-radius:12px}
.download{background:#dff7ea;padding:8px 12px;border-radius:10px;color:#006b2f;font-weight:700;margin-left:8px;cursor:pointer;border:2px solid rgba(0,0,0,0.08)}
.zoomRow{display:flex;align-items:center;gap:8px;margin-top:6px}
.logs{height:140px;overflow:auto;background:#fff;padding:8px;border-radius:8px;border:1px dashed #e6f6fb}
@media(max-width:900px){.grid{grid-template-columns:1fr;}.gauge{width:100%}}
</style>

<script src='https://cdn.jsdelivr.net/npm/chart.js'></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>
<div class='wrap'>
Â  <div class='header'>
Â  Â  <img src='./DESPRO.png' alt='SPLASH' style='height:200px;margin-right:12px;'>
Â  </div>
Â  <div class='grid'>
Â  Â  <div class='left'>
Â  Â  Â  <div class='card'>
Â  Â  Â  Â  <div style='display:flex;align-items:center;justify-content:space-between'>
Â  Â  Â  Â  Â  <h2 style='margin:0'>Water Flow (Firebase)</h2>
Â  Â  Â  Â  Â  <div style='font-size:14px;color:#666'>Last update: <span id='lastUpdate'>--:--:--</span></div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class='gauge-row' style='margin-top:12px'>
Â  Â  Â  Â  Â  <div class='gauge' id='gauge1'>
Â  Â  Â  Â  Â  Â  <svg viewBox='0 0 220 120'>
Â  Â  Â  Â  Â  Â  Â  <defs><linearGradient id='g1' x1='0' x2='1'><stop offset='0' stop-color='#8DE2A6'/><stop offset='0.6' stop-color='#F8C46C'/><stop offset='1' stop-color='#F06E6E'/></linearGradient></defs>
Â  Â  Â  Â  Â  Â  Â  <path d='M20 100 A90 90 0 0 1 200 100' fill='none' stroke='#ddd' stroke-width='18' stroke-linecap='round'></path>
Â  Â  Â  Â  Â  Â  Â  <path id='arc1' d='M20 100 A90 90 0 0 1 200 100' fill='none' stroke='url(#g1)' stroke-width='18' stroke-linecap='round' stroke-dasharray='0 565' stroke-linejoin='round'></path>
Â  Â  Â  Â  Â  Â  Â  <line id='needle1' x1='110' y1='100' x2='110' y2='30' stroke='#58386a' stroke-width='6' stroke-linecap='round' transform='rotate(-90 110 100)'></line>
Â  Â  Â  Â  Â  Â  Â  <circle cx='110' cy='100' r='8' fill='#58386a'></circle>
Â  Â  Â  Â  Â  Â  </svg>
Â  Â  Â  Â  Â  Â  <div class='percent' id='p1'>-- %</div>
Â  Â  Â  Â  Â  Â  <div class='percent' style='font-size:14px;color:#555' id='p1ml'>-- mL/s</div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class='gauge' id='gauge2'>
Â  Â  Â  Â  Â  Â  <svg viewBox='0 0 220 120'>
Â  Â  Â  Â  Â  Â  Â  <defs><linearGradient id='g2' x1='0' x2='1'><stop offset='0' stop-color='#8DE2A6'/><stop offset='0.6' stop-color='#F8C46C'/><stop offset='1' stop-color='#F06E6E'/></linearGradient></defs>
Â  Â  Â  Â  Â  Â  Â  <path d='M20 100 A90 90 0 0 1 200 100' fill='none' stroke='#ddd' stroke-width='18' stroke-linecap='round'></path>
Â  Â  Â  Â  Â  Â  Â  <path id='arc2' d='M20 100 A90 90 0 0 1 200 100' fill='none' stroke='url(#g2)' stroke-width='18' stroke-linecap='round' stroke-dasharray='0 565'></path>
Â  Â  Â  Â  Â  Â  Â  <line id='needle2' x1='110' y1='100' x2='110' y2='30' stroke='#58386a' stroke-width='6' stroke-linecap='round' transform='rotate(-90 110 100)'></line>
Â  Â  Â  Â  Â  Â  Â  <circle cx='110' cy='100' r='8' fill='#58386a'></circle>
Â  Â  Â  Â  Â  Â  </svg>
Â  Â  Â  Â  Â  Â  <div class='percent' id='p2'>-- %</div>
Â  Â  Â  Â  Â  Â  <div class='percent' style='font-size:14px;color:#555' id='p2ml'>-- mL/s</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
        
        Â  Â  Â  Â  <div class='status' style='margin-top:14px'>
Â  Â  Â  Â  Â  <div id='leakBadge' class='badge ok'>SYSTEM OK</div>
Â  Â  Â  Â  Â  <div style='display:flex;justify-content:space-between;gap:20px;align-items:center'>
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <div style='margin-bottom:8px;font-weight:700'>Water Pump</div>
Â  Â  Â  Â  Â  Â  Â  <div style='margin-bottom:8px;font-weight:700'>Solenoid Valve</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div style='text-align:right'>
Â  Â  Â  Â  Â  Â  Â  <div id='pumpLabel' class='indicator off'>-</div>
Â  Â  Â  Â  Â  Â  Â  <div id='valveLabel' class='indicator off' style='margin-top:8px'>-</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class='ctrl' id='valveCtrlContainer'>
Â  Â  Â  Â  Â  Â  <div style='font-weight:700; color:#333; margin-right:10px'>Valve Manual Control:</div>
Â  Â  Â  Â  Â  Â  <button id='openValveBtn' class='btn on' style='background:#19a974; width:120px'>Open / Reset</button>
Â  Â  Â  Â  Â  Â  <button id='closeValveBtn' class='btn off' style='width:120px'>Close</button>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class='ctrl'>
Â  Â  Â  Â  Â  Â  <button id='toggleBtn' class='btn off'>Turn Pump ON</button>
Â  Â  Â  Â  Â  Â  <div style='font-size:12px;color:#666'>You can click the button or toggle from physical controller</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div class='card'>
Â  Â  Â  Â  <h3 style='margin:0 0 8px 0'>Status & Logs</h3>
Â  Â  Â  Â  <div id='logArea' class='logs'></div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div class='chart-card'>
Â  Â  Â  <div style='display:flex;align-items:center;justify-content:space-between'>
Â  Â  Â  Â  <h3 style='margin:0'>Data</h3>
Â  Â  Â  Â  <div style='display:flex;align-items:center;gap:6px'>
Â  Â  Â  Â  Â  <button id='dlCsvPct' class='download'>Download CSV</button>
Â  Â  Â  Â  Â  <button id='dlPngPct' class='download'>Download PNG</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div class='zoomRow'>
Â  Â  Â  Â  <label for='zoomRange'>Show last</label>
Â  Â  Â  Â  <input id='zoomRange' type='range' min='5' max='100' value='30' step='1' />
Â  Â  Â  Â  <span id='zoomVal'>30</span>data
Â  Â  Â  Â  <div style='font-size:12px;color:#666;margin-left:10px'>(Data Per Sampel)</div>
Â  Â  Â  </div>

Â  Â  Â  <div class='chart-nav' style='display:flex;align-items:center;justify-content:space-between;margin-top:8px'>
Â  Â  Â  Â  <button id='prevBtn' class='btn off' style='padding:6px 10px'>&larr; Prev</button>
Â  Â  Â  Â  <span id='dataRangeInfo' style='font-size:12px'>Showing data -- of --</span>
Â  Â  Â  Â  <button id='nextBtn' class='btn off' style='padding:6px 10px'>Next &rarr;</button>
Â  Â  Â  Â  </div>
Â  Â  Â  <div style='margin-top:8px;font-weight:600;'>Flow (%)</div>
Â  Â  Â  <canvas id='lineChart' style='width:100%;height:320px;margin-top:4px;'></canvas>

Â  Â  Â  <div style='margin-top:12px;font-weight:600;display:flex;justify-content:space-between;align-items:center;'>
Â  Â  Â  Â  Flow (mL/s)
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <button id='dlCsvMlps' class='download' style='font-size:12px;padding:6px 10px;'>Download CSV</button>
Â  Â  Â  Â  Â  <button id='dlPngMlps' class='download' style='font-size:12px;padding:6px 10px;'>Download PNG</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <canvas id='lineChartMlps' style='width:100%;height:320px;margin-top:4px;'></canvas>

Â  Â  Â  Â  Â  Â  <div style='margin-top:16px;'>
Â  Â  Â  Â  <img id='imgOk' src='./OKEY.png' alt='Pipeline OK'
Â  Â  Â  Â  Â  Â  Â style='width:100%;max-height:220px;object-fit:contain;border-radius:12px;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  background:#fff;box-shadow:0 4px 12px rgba(0,0,0,0.06);'>
Â  Â  Â  Â  <img id='imgLeak' src='./BOCOR.png' alt='Pipeline leak'
Â  Â  Â  Â  Â  Â  Â style='width:100%;max-height:220px;object-fit:contain;border-radius:12px;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  background:#fff;box-shadow:0 4px 12px rgba(0,0,0,0.06);display:none;'>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>
</div>

<script>
// ðŸš¨ GANTI DENGAN KONFIGURASI WEB APP FIREBASE ANDA ðŸš¨
// Ambil konfigurasi ini dari Firebase Console -> Project settings -> Web App
const firebaseConfig = {
Â  apiKey: "YOUR_FIREBASE_CONFIG_API_KEY", 
Â  authDomain: "YOUR_FIREBASE_CONFIG_AUTH_DOMAIN",
Â  databaseURL: "https://splash-kelompok28-default-rtdb.asia-southeast1.firebasedatabase.app/", // Sudah di-set sesuai permintaan
Â  projectId: "YOUR_FIREBASE_CONFIG_PROJECT_ID",
Â  storageBucket: "YOUR_FIREBASE_CONFIG_STORAGE_BUCKET",
Â  messagingSenderId: "YOUR_FIREBASE_CONFIG_MESSAGING_SENDER_ID",
Â  appId: "YOUR_FIREBASE_CONFIG_APP_ID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const dbRefRealtime = db.ref('realtime');
const dbRefHistory = db.ref('history');
const dbRefControl = db.ref('control');


let lineChart, lineChartMlps, lastData=null;
const MAX_FLOW_LPM = 30.0;
const MLPS_MAX = MAX_FLOW_LPM * 1000.0 / 60.0;
const pctToMlps = (pct)=> (pct/100.0) * MLPS_MAX;
let dataOffset = 0;
let historyArray = []; 

// Fungsi mkLine, setGauge, appendLog (Sama)
const mkLine=()=>{
Â  const ctx=document.getElementById('lineChart').getContext('2d');
Â  lineChart=new Chart(ctx,{
Â  Â  type:'line',
Â  Â  data:{labels:[],datasets:[
Â  Â  Â  {label:'Water Flow 1 (%)',borderColor:'#19a974',pointRadius:4,backgroundColor:'transparent',data:[]},
Â  Â  Â  {label:'Water Flow 2 (%)',borderColor:'#e74c3c',pointRadius:4,backgroundColor:'transparent',data:[]}
Â  Â  ]},
Â  Â  options:{animation:{duration:200},scales:{y:{min:0,max:100}},plugins:{legend:{position:'top'}}}
Â  });
Â  const ctx2=document.getElementById('lineChartMlps').getContext('2d');
Â  lineChartMlps=new Chart(ctx2,{
Â  Â  type:'line',
Â  Â  data:{labels:[],datasets:[
Â  Â  Â  {label:'Water Flow 1 (mL/s)',borderColor:'#19a974',pointRadius:4,backgroundColor:'transparent',data:[]},
Â  Â  Â  {label:'Water Flow 2 (mL/s)',borderColor:'#e74c3c',pointRadius:4,backgroundColor:'transparent',data:[]}
Â  Â  ]},
Â  Â  options:{animation:{duration:200},scales:{y:{min:0,max:MLPS_MAX}},plugins:{legend:{position:'top'}}}
Â  });
};

const setGauge=(id, v)=>{
Â  v=Math.max(0,Math.min(100,Math.round(v)));
Â  const pct = v/100;
Â  const dash = Math.round(565 * pct);
Â  const mlps = pctToMlps(v);

Â  if(id==='g1'){
Â  Â  document.getElementById('arc1').setAttribute('stroke-dasharray', dash+' 565');
Â  Â  const angle = -90 + (v/100)*180;
Â  Â  document.getElementById('needle1').setAttribute('transform','rotate('+angle+' 110 100)');
Â  Â  document.getElementById('p1').innerText = v + ' %';
Â  Â  document.getElementById('p1ml').innerText = mlps.toFixed(1) + ' mL/s';
Â  } else {
Â  Â  document.getElementById('arc2').setAttribute('stroke-dasharray', dash+' 565');
Â  Â  const angle = -90 + (v/100)*180;
Â  Â  document.getElementById('needle2').setAttribute('transform','rotate('+angle+' 110 100)');
Â  Â  document.getElementById('p2').innerText = v + ' %';
Â  Â  document.getElementById('p2ml').innerText = mlps.toFixed(1) + ' mL/s';
Â  }
};

const appendLog=(s)=>{
Â  const la=document.getElementById('logArea');
Â  const now=new Date().toLocaleTimeString();
Â  la.innerHTML = '['+now+'] '+s + '<br>' + la.innerHTML;
};

// Fungsi untuk update UI dari data real-time Firebase
const updateUI=(j)=>{
Â  if (!j) return;
Â  lastData=j;
Â  const f1=j.flow1, f2=j.flow2;
Â  setGauge('g1', f1);
Â  setGauge('g2', f2);

Â  const pumpEl = document.getElementById('pumpLabel');
Â  pumpEl.innerText = j.pump? 'ON' : 'OFF';
Â  pumpEl.className = 'indicator ' + (j.pump? 'on':'off');

Â  const valveEl = document.getElementById('valveLabel');
Â  valveEl.innerText = j.valve? 'OPEN' : 'CLOSED';

Â  const leak = j.leakLockout || false;

Â  if(leak){
Â  Â  document.getElementById('leakBadge').className='badge danger';
Â  Â  document.getElementById('leakBadge').innerText='WATER LEAKAGE DETECTED! (LOCKED)';
Â  Â  valveEl.className = 'indicator off'; 
Â  } else {
Â  Â  document.getElementById('leakBadge').className='badge ok';
Â  Â  document.getElementById('leakBadge').innerText='SYSTEM OK';
Â  Â  valveEl.className = 'indicator ' + (j.valve? 'on':'off');
Â  }

Â  // Gambar: show/hide
Â  const imgOk Â  = document.getElementById('imgOk');
Â  const imgLeak = document.getElementById('imgLeak');
Â  if (imgOk && imgLeak) {
Â  Â  if (leak) {
Â  Â  Â  imgOk.style.display Â  = 'none';
Â  Â  Â  imgLeak.style.display = 'block';
Â  Â  } else {
Â  Â  Â  imgOk.style.display Â  = 'block';
Â  Â  Â  imgLeak.style.display = 'none';
Â  Â  }
Â  }

Â  const ml1 = pctToMlps(f1).toFixed(1);
Â  const ml2 = pctToMlps(f2).toFixed(1);
Â  appendLog(
Â  Â  'updated: f1='+f1+'% ('+ml1+' mL/s) '+
Â  Â  'f2='+f2+'% ('+ml2+' mL/s) '+
Â  Â  'pump='+j.pump+' valve='+j.valve + (leak ? ' (LEAK LOCK)' : '')
Â  );

Â  document.getElementById('lastUpdate').innerText = new Date().toLocaleTimeString();
Â  const btn=document.getElementById('toggleBtn');
Â  btn.className = 'btn ' + (j.pump? 'on':'off');
Â  btn.innerText = j.pump? 'Turn Pump OFF' : 'Turn Pump ON';
};


// Fungsi untuk update chart dari data historyArray
const updateChartSeries=()=>{
Â  if(!lineChart || !lineChartMlps || historyArray.length === 0) return;

Â  let arr = historyArray.slice(); 
Â  
Â  const totalSamples = arr.length;
Â  const displaySize = parseInt(document.getElementById('zoomRange').value || '30');

Â  if(dataOffset < 0) dataOffset = 0;
Â  if(dataOffset > totalSamples - displaySize) {
Â  Â  dataOffset = Math.max(0, totalSamples - displaySize);
Â  }
Â  
Â  // Logika Navigasi
Â  document.getElementById('nextBtn').disabled = dataOffset === 0;
Â  document.getElementById('prevBtn').disabled = (totalSamples <= displaySize) || (dataOffset >= totalSamples - displaySize);

Â  const endIndex = totalSamples - dataOffset;
Â  const startIndex = totalSamples - displaySize - dataOffset;
Â  const displayArr = arr.slice(Math.max(0, startIndex), endIndex);

Â  const startIdxDisp = Math.max(0, startIndex) + 1;
Â  const endIdxDisp = endIndex > totalSamples ? totalSamples : endIndex;
Â  document.getElementById('dataRangeInfo').innerText = 
Â  Â  `Showing data ${startIdxDisp} to ${endIdxDisp} of ${totalSamples}`;
Â  
Â  let labels=[], d1=[], d2=[], m1=[], m2=[];
Â  
Â  displayArr.forEach(p=>{
Â  Â  labels.push(new Date(p.tms).toLocaleTimeString());
Â  Â  d1.push(p.f1);
Â  Â  d2.push(p.f2);
Â  Â  m1.push(pctToMlps(p.f1));
Â  Â  m2.push(pctToMlps(p.f2));
Â  });

Â  lineChart.data.labels = labels;
Â  lineChart.data.datasets[0].data = d1;
Â  lineChart.data.datasets[1].data = d2;
Â  lineChart.update();

Â  lineChartMlps.data.labels = labels;
Â  lineChartMlps.data.datasets[0].data = m1;
Â  lineChartMlps.data.datasets[1].data = m2;
Â  lineChartMlps.update();
};

// LISTENERS FIREBASE
dbRefRealtime.on('value', (snapshot) => {
Â  const data = snapshot.val();
Â  updateUI(data);
}, (error) => {
Â  console.error("Error reading realtime data:", error);
Â  appendLog("Error reading realtime data from Firebase!");
});

dbRefHistory.orderByChild('tms').limitToLast(100).on('value', (snapshot) => {
Â  // Mengambil 100 data terakhir dari history
Â  historyArray = [];
Â  snapshot.forEach((childSnapshot) => {
Â  Â  historyArray.push(childSnapshot.val());
Â  });
Â  historyArray.sort((a, b) => a.tms - b.tms); 
Â  updateChartSeries();
}, (error) => {
Â  console.error("Error reading history data:", error);
});


// EVENT LISTENERS DOM (Kontrol melalui Firebase Write)
document.addEventListener('click', async (ev)=>{
Â  if(ev.target && ev.target.id==='toggleBtn'){
Â  Â  const currentPumpState = lastData ? lastData.pump : false;
Â  Â  await dbRefControl.child('pumpToggle').set(!currentPumpState);
Â  }
Â  if(ev.target && ev.target.id==='openValveBtn'){
Â  Â  if(confirm("MEMBUKA KATUP MANUAL: Ini akan mereset status Lockout Kebocoran dan menjalankan Startup Delay (7s). Lanjutkan?")){
Â  Â  Â  await dbRefControl.child('valveControl').set('open');
Â  Â  }
Â  }
Â  if(ev.target && ev.target.id==='closeValveBtn'){
Â  Â  if(confirm("MENUTUP KATUP MANUAL: Ini akan mengaktifkan Leak Lockout. Lanjutkan?")){
Â  Â  Â  await dbRefControl.child('valveControl').set('close');
Â  Â  }
Â  }
});

// FUNCTIONS Chart Control & Download (Sama)
const zoomRange = document.getElementById('zoomRange');
const zoomVal = document.getElementById('zoomVal');

document.getElementById('dlCsvPct').addEventListener('click', ()=>{ downloadCsv('pct'); });
document.getElementById('dlPngPct').addEventListener('click', ()=>{ downloadPng(lineChart); });
document.getElementById('dlCsvMlps').addEventListener('click', ()=>{ downloadCsv('mlps'); });
document.getElementById('dlPngMlps').addEventListener('click', ()=>{ downloadPng(lineChartMlps); });

const downloadCsv = (type) => {
Â  if(historyArray.length === 0) return alert('No data');
Â  
Â  let csv = 'tms,iso,flow1_pct,flow2_pct,flow1_mlps,flow2_mlps\n';
Â  historyArray.forEach(r=>{
Â  Â  const ml1 = pctToMlps(r.f1);
Â  Â  const ml2 = pctToMlps(r.f2);
Â  Â  csv += r.tms + ','
Â  Â  Â  Â  + (new Date(r.tms)).toISOString() + ','
Â  Â  Â  Â  + r.f1 + ','
Â  Â  Â  Â  + r.f2 + ','
Â  Â  Â  Â  + ml1.toFixed(3) + ','
Â  Â  Â  Â  + ml2.toFixed(3) + '\n';
Â  });

Â  const blob = new Blob([csv], {type:'text/csv'});
Â  const url = URL.createObjectURL(blob);
Â  const a = document.createElement('a'); a.href = url;
Â  a.download = 'splash_data_per_sample_'+type+'.csv'; a.click(); URL.revokeObjectURL(url);
};

const downloadPng = (chart) => {
Â  if(!chart) return;
Â  try{
Â  Â  const imgSrc = chart.toBase64Image();
Â  Â  const img = new Image();
Â  Â  img.onload = ()=>{
Â  Â  Â  const W = 1600, H = 900;
Â  Â  Â  const cv = document.createElement('canvas');
Â  Â  Â  cv.width = W; cv.height = H;
Â  Â  Â  const ctx = cv.getContext('2d');
Â  Â  Â  ctx.fillStyle = '#ffffff'; ctx.fillRect(0,0,W,H);
Â  Â  Â  ctx.drawImage(img, 0, 0, W, H);
Â  Â  Â  const url = cv.toDataURL('image/png');
Â  Â  Â  const a = document.createElement('a'); a.href = url;
Â  Â  Â  const type = chart.canvas.id === 'lineChart' ? 'pct' : 'mlps';
Â  Â  Â  a.download = 'splash_chart_'+type+'.png'; a.click();
Â  Â  };
Â  Â  img.src = imgSrc;
Â  }catch(e){ console.error(e); alert('Export failed'); }
};

document.getElementById('prevBtn').addEventListener('click', ()=>{
Â  const step = parseInt(document.getElementById('zoomRange').value || '30');
Â  dataOffset += step;
Â  updateChartSeries();
});

document.getElementById('nextBtn').addEventListener('click', ()=>{
Â  const step = parseInt(document.getElementById('zoomRange').value || '30');
Â  dataOffset -= step;
Â  updateChartSeries();
});

zoomRange.addEventListener('input', ()=>{
Â  zoomVal.innerText = zoomRange.value;
Â  dataOffset = 0;
Â  updateChartSeries();
});

window.addEventListener('load', ()=>{
Â  mkLine();
});
</script>
</body>
</html>
